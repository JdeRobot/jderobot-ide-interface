(()=>{"use strict";const t={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let e;const n=new Uint8Array(16),o=[];for(let t=0;t<256;++t)o.push((t+256).toString(16).slice(1));const r=function(r,s,i){if(t.randomUUID&&!s&&!r)return t.randomUUID();const a=(r=r||{}).random??r.rng?.()??function(){if(!e){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");e=crypto.getRandomValues.bind(crypto)}return e(n)}();if(a.length<16)throw new Error("Random bytes length must be >= 16");if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,s){if((i=i||0)<0||i+16>s.length)throw new RangeError(`UUID byte range ${i}:${i+15} is out of buffer bounds`);for(let t=0;t<16;++t)s[i+t]=a[t];return s}return function(t,e=0){return(o[t[e+0]]+o[t[e+1]]+o[t[e+2]]+o[t[e+3]]+"-"+o[t[e+4]]+o[t[e+5]]+"-"+o[t[e+6]]+o[t[e+7]]+"-"+o[t[e+8]]+o[t[e+9]]+"-"+o[t[e+10]]+o[t[e+11]]+o[t[e+12]]+o[t[e+13]]+o[t[e+14]]+o[t[e+15]]).toLowerCase()}(a)};!function(){function t(t){var e=this;this.observers={},this.pendingPromises=new Map,this.subscribe=function(t,n){"string"==typeof t&&(t=[t]);for(var o=0,r=t.length;o<r;o++)e.observers[t[o]]=e.observers[t[o]]||[],e.observers[t[o]].push(n)},this.subscribeOnce=function(t,n){e.subscribe(t,(function(o){n(o),e.unsubscribe(t,n)}))},this.unsubscribe=function(t,n){"string"==typeof t&&(t=[t]);for(var o=0,r=t.length;o<r;o++)e.observers[t[o]]=e.observers[t[o]]||[],e.observers[t[o]].splice(e.observers[t[o]].indexOf(n))},this.unsuscribeAll=function(){for(var t in e.observers)e.observers[t].length=0},this.ws=new WebSocket(t),this.subscribe("state-changed",this.setManagerState),this.subscribeOnce("introspection",this.setHostData),this.ws.onmessage=function(t){var n=JSON.parse(t.data),o=e.pendingPromises.get(n.id);if(o){var r=o.resolve,s=o.reject;"ack"===n.command?r(n):"error"===n.command&&s(n),e.pendingPromises.delete(n.id)}else for(var i=e.observers[n.command]||[],a=i.length;a--;)i[a](n)},this.ws.onclose=function(e){e.wasClean?console.log("Connection with ".concat(t," closed, all suscribers cleared")):console.log("Connection with ".concat(t," interrupted"))}}t.getInstance=function(){return t.instance||(t.instance=new t("ws://127.0.0.1:7163")),t.instance},t.deleteInstance=function(){t.instance&&(delete t.instance,t.instance=void 0)},t.prototype.send=function(t,e){return n=this,o=void 0,i=function(){var n,o=this;return function(t,e){var n,o,r,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=a(0),i.throw=a(1),i.return=a(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,(function(s){return n=r(),this.ws&&this.ws.readyState===WebSocket.OPEN?[2,new Promise((function(r,s){o.pendingPromises.set(n,{resolve:r,reject:s});var i=JSON.stringify({id:n,command:t,data:e});o.ws.send(i)}))]:[2,Promise.reject(new Error("WebSocket not connected"))]}))},new((s=void 0)||(s=Promise))((function(t,e){function r(t){try{c(i.next(t))}catch(t){e(t)}}function a(t){try{c(i.throw(t))}catch(t){e(t)}}function c(e){var n;e.done?t(e.value):(n=e.value,n instanceof s?n:new s((function(t){t(n)}))).then(r,a)}c((i=i.apply(n,o||[])).next())}));var n,o,s,i},t.prototype.setManagerState=function(e){!function(t,e){void 0===e&&(e=void 0);var n=new CustomEvent("CommsManagerStateChange",{detail:e});document.dispatchEvent(n)}(0,{state:e.data.state}),t.state=e.data.state,"connected"===e.data.state&&(t.universe=void 0)},t.prototype.getState=function(){return t.state},t.prototype.setHostData=function(e){t.hostData=e.data},t.prototype.getHostData=function(){return t.hostData},t.prototype.getUniverse=function(){return t.universe},t.prototype.connect=function(){return this.send("connect")},t.prototype.launchWorld=function(e){return t.universe=e.name,this.send("launch_world",e)},t.prototype.prepareVisualization=function(t,e){return null==e&&(e="None"),this.send("prepare_visualization",{type:t,file:e})},t.prototype.run=function(t){return this.send("run_application",t)},t.prototype.stop=function(){return this.send("stop")},t.prototype.pause=function(){return this.send("pause")},t.prototype.resume=function(){return this.send("resume")},t.prototype.reset=function(){return this.send("reset")},t.prototype.terminateApplication=function(){return this.send("terminate_application")},t.prototype.terminateVisualization=function(){return this.send("terminate_visualization")},t.prototype.terminateUniverse=function(){return this.send("terminate_universe")},t.prototype.disconnect=function(){return this.send("disconnect")},t.prototype.style_check=function(t){return this.send("style_check",{code:t})},t.prototype.code_format=function(t){return this.send("code_format",{code:t})},t.prototype.code_analysis=function(t,e){return this.send("code_analysis",{code:t,disable_errors:e})},t.prototype.code_autocomplete=function(t,e,n){return this.send("code_autocomplete",{code:t,line:e,col:n})},t.state="idle"}()})();